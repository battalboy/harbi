# ‚ö†Ô∏è CRITICAL CONTEXT - READ THIS FIRST ‚ö†Ô∏è

**THIS IS COMMISSIONED CLIENT SOFTWARE - NOT A PERSONAL PROJECT**

- **5-6 paying clients** will use this system
- **Clients are Turkish** - all notifications, error messages, and UI text will eventually be in Turkish
- **Clients need web access from anywhere** (no Python knowledge required)
- **Remote production server**: 89.125.255.32 (giray@)
- **Clients CANNOT run scripts manually** - must access via web interface or receive Telegram messages
- **Production deployment is the END GOAL**, not just proof-of-concept
- **Web server required**: Flask application for client access (not simple HTTP server)

**EVERY decision must consider: "Will this work for non-technical clients accessing via web?"**

---

# Harbi - Arbitrage Betting System (Arbing Software)

## Client Requirements

**This is a commissioned software project.** The client requires that all traditional betting sites included in the project operate at **full capacity**, meaning:

- **Maximum team coverage**: Each traditional betting site must have as many team names collected as possible
- **Balanced coverage**: Having 150 teams for one site while another site has 1,000+ teams is **not acceptable**
- **Quality standard**: All included sites must provide comparable and comprehensive team coverage to maximize arbitrage opportunities
- **Implementation priority**: If a site cannot provide adequate team coverage through available API methods, alternative approaches (browser automation, etc.) must be implemented to meet the client's requirements

**Current Coverage Status:**
- Oddswar: ~1,874 teams ‚úÖ (Master key - defines available opportunities)
- Stoiximan: ~3,521 teams ‚úÖ (Excellent coverage - 88.8% match rate)
- Tumbet: ~1,700+ teams ‚úÖ (Excellent coverage - uses comprehensive getheader endpoint)
- Roobet: ~1,545 teams ‚úÖ (Good coverage - ~38% match rate)
- Stake: ~203 teams ‚ö†Ô∏è (Growing - depends on active leagues, browser automation)

## Project Overview

**Project Name**: Harbi

This is **ARBING SOFTWARE**, not betting software. The goal is to identify and exploit odds discrepancies between:
- **Oddswar** (betting exchange - where you can "sell" or lay odds)
- **Stoiximan, Roobet, Stake & Tumbet** (traditional bookmakers - where you "buy" or back odds)

### How Arbitrage Works
1. Find the same event on both exchange and traditional bookmaker
2. Compare odds
3. When there's a profitable spread, "back" on the traditional site and "lay" on Oddswar
4. Profit from the difference with **minimal risk** (not speculative betting)

### Key Distinction
- **Traditional Bookmaker** (Stoiximan/Roobet/Stake/Tumbet): You bet FOR an outcome
- **Betting Exchange** (Oddswar): You can bet AGAINST an outcome (act as the bookmaker)
- **Arbitrage Opportunity**: When backing + laying the same outcome creates guaranteed profit

## Core Challenge: Two-Step Standardization

### Key Definitions
- **Team Name**: A single team (e.g., "Manchester United", "Liverpool FC")
- **Event**: When two teams are playing or have an upcoming match (e.g., "Manchester United vs Liverpool")
- **Goal**: Match team names across sites ‚Üí Match events across sites ‚Üí Compare odds for arbitrage

### Step 1: Standardize Team Names
The same team has different names across bookmakers.
- Example: "Man United" vs "Manchester United FC" vs "Manchester Utd"
- **Current focus**: Building team name mappings (`stoiximan_matches.csv`, `roobet_matches.csv`, `tumbet_matches.csv`)
- **Tools**: Fuzzy matching with special rules (indicators, diacritics)
- **Purpose**: Enable accurate event matching in Step 2

#### Matching Algorithm Details
The matching system uses **indicator-first filtering** to ensure accurate matches:

**Indicators Extracted:**
- **Age groups**: U19, U20, U21, U23 (youth teams)
- **Gender**: (W) (women's teams)
- **Reserve teams**: II or B (treated as equivalent under 'RESERVE' indicator)

**Matching Rules:**
- Teams are filtered by indicators BEFORE fuzzy matching
- Only teams with EXACT matching indicators can be compared
- Examples:
  - ‚úÖ Arsenal U19 ‚Üí can ONLY match teams with U19
  - ‚úÖ Arsenal (W) ‚Üí can ONLY match teams with (W)
  - ‚úÖ Arsenal ‚Üí can ONLY match teams WITHOUT indicators
  - ‚ùå Arsenal U19 ‚Üí CANNOT match Arsenal (no U19)
  - ‚ùå Arsenal (W) ‚Üí CANNOT match Arsenal FC (no W)
  - ‚ùå Juventus U20 ‚Üí CANNOT match Juventus U23 (different ages)

**Normalization Process:**
- **Diacritics removal**: √úmraniyespor ‚Üí Umraniyespor, Be≈üikta≈ü ‚Üí Besiktas
- **Case-insensitive**: NEOM Sports Club ‚Üí neom sports club (for comparison only)
- **Original names preserved**: Output CSVs contain original team names with proper casing

**Fuzzy Matching:**
- Uses `rapidfuzz` library with `fuzz.ratio` scorer
- **Current threshold**: 60% minimum similarity required for a match
- Lower threshold allows catching abbreviations (e.g., "Sports Club" vs "SC" at 60.9%)
- Accepts risk of false positives requiring manual review

#### Team Collection Scripts
- **Oddswar**: `collect_oddswar_teams.py` ‚Üí outputs `oddswar_names.txt`
  - **Sport IDs**: 
    - Soccer: `1` (API: `/api/brand/1oddswar/exchange/soccer-1` or `/exchange/1`)
    - Tennis: `2` (API: `/api/brand/1oddswar/exchange/tennis-2` or `/exchange/2`)
    - Basketball: `7522` (API: `/api/brand/1oddswar/exchange/7522`)
  - **API Requirements**: Minimum `size=50` parameter required
  - Soccer: 3-way odds (Team 1, Draw, Team 2)
  - Tennis: 2-way odds (Player 1, Player 2 - no draw)
  - Basketball: 2-way odds (Team 1, Team 2 - no draw)
- **Stoiximan**: `collect_stoiximan_teams.py` ‚Üí outputs `stoiximan_names.txt`
- **Roobet**: `collect_roobet_teams.py` ‚Üí outputs `roobet_names.txt`
  - Uses Betby API (sptpub.com) with two-step version system
  - **Sport IDs**:
    - Soccer: `1` (API filter: `desc.get('sport') == '1'`)
    - Basketball: `2` (API filter: `desc.get('sport') == '2'`)
    - Tennis: `5` (API filter: `desc.get('sport') == '5'`)
  - Soccer: 3-way odds (Team 1, Draw, Team 2)
  - Tennis: 2-way odds (Player 1, Player 2 - no draw)
  - Basketball: 2-way odds (Team 1, Team 2 - no draw)
  - **Breakthrough discovery**: The `rest_events_versions` array in API manifest unlocks comprehensive coverage
  - **Critical**: Fetches from multiple `rest_events_versions` endpoints (each contains ~160 matches)
  - Changed collection from ~60 teams (main version only) to 700+ teams (all versions)
  - Can collect comprehensive coverage in single run (~10 seconds) vs waiting days/weeks
  - Fetches both LIVE and PREMATCH matches
  - No geographic restrictions
- **Tumbet**: `collect_tumbet_teams.py` ‚Üí outputs `tumbet_names.txt`
  - Uses SportWide API (analytics-sp.googleserv.tech)
  - **Sport IDs**:
    - Soccer: `1` (API filter: `sport.get('id') == 1`)
    - Basketball: `2` (API filter: `sport.get('id') == 2`)
    - Tennis: `5` (API filter: `sport.get('id') == 5`)
  - Soccer: 3-way odds (Team 1, Draw, Team 2)
  - Tennis: 2-way odds (Player 1, Player 2 - no draw)
  - Basketball: 2-way odds (Team 1, Team 2 - no draw)
  - **Breakthrough discovery**: The `/api/sport/getheader/{LANGUAGE}` endpoint unlocks comprehensive coverage
  - **Critical**: Fetches from hierarchical structure (Sports ‚Üí Regions ‚Üí Championships ‚Üí Games)
  - Changed collection from ~109 teams (top games only) to ~1,700+ teams (all games)
  - Can collect comprehensive coverage in single run (~10-15 seconds with batching)
  - **‚ö†Ô∏è LIVE DATA STATUS**: The old live endpoint `/api/live/getlivegames/ot` returns 404 (broken/moved)
    - Currently **PREMATCH ONLY** via `getheader` endpoint (1,176+ matches)
    - The `getheader` endpoint does NOT include live matches (verified - no live indicators in data structure)
    - **TODO**: Find new live match API endpoint (see Outstanding Tasks section below)
  - No geographic restrictions on API (website requires Turkish VPN)
- **Stake**: `collect_stake_teams.py` ‚Üí outputs `stake_names.txt`
  - Uses Sportradar (MTS - Managed Trading Services) for odds backend
  - **No public API** - requires browser automation with DOM scraping
  - Uses `undetected-chromedriver` to bypass Cloudflare protection
  - **Geoblocked**: Requires VPN (Canada, Germany, Brazil recommended)
  - **Key selector**: `span.ds-body-md-strong.truncate` (discovered via Browser MCP)
  - Smart `/all` redirect detection: skips empty leagues (off-season)
  - Scrapes 23+ major tournaments across multiple countries
  - Coverage varies by season (leagues redirect to `/all` when no active matches)
  - ~203 teams currently (grows as leagues come in season)
  - **Alternative**: Paid scraping service available at https://scrappey.com/scrapers/finance/stake.com-scraper (may be considered for future use)

**Basketball Team Collectors (All Created ‚úÖ):**
- **Oddswar Basketball**: `collect_oddswar_basketball.py` ‚Üí outputs `oddswar_basketball_names.txt`
  - Sport ID: `7522`
  - ~128 teams collected (Live + Today + Upcoming intervals)
- **Stoiximan Basketball**: `collect_stoiximan_basketball.py` ‚Üí outputs `stoiximan_basketball_names.txt`
  - Sport ID: `'BASK'`
  - ~49 teams collected (Featured games only - builds up over time)
  - **‚ö†Ô∏è Coverage Limitation**: Only ~28 featured/popular games available at any time via `/live/overview/latest`
  - **No comprehensive prematch API found** (investigated extensively - would require HTML scraping)
  - **HTML scraping rejected**: Excessive bandwidth usage (50-150 MB per fetch) vs API (1-3 MB)
  - Filters out virtual tournament teams (GODFATHER, KJMR, RIDER, CARNAGE, CRYPTO, ARCHER, mist, RAMZ)
  - Uses `cloudscraper` to bypass Cloudflare protection
- **Roobet Basketball**: `collect_roobet_basketball.py` ‚Üí outputs `roobet_basketball_names.txt`
  - Sport ID: `2`
  - ~211 teams collected (Live + Prematch via all version endpoints)
  - Includes metadata filtering (removes 'Awards', year patterns like '2025/26')
- **Tumbet Basketball**: `collect_tumbet_basketball.py` ‚Üí outputs `tumbet_basketball_names.txt`
  - Sport ID: `2`
  - ~400 teams collected (comprehensive coverage via getheader endpoint)
  - Uses batched API calls for efficiency

#### Team Matching Scripts
- **Stoiximan Matching**: `create_stoiximan_matches_csv.py` ‚Üí creates `stoiximan_matches.csv` (Oddswar ‚Üî Stoiximan mappings with confidence scores)
- **Roobet Matching**: `create_roobet_matches_csv.py` ‚Üí creates `roobet_matches.csv` (Oddswar ‚Üî Roobet mappings with confidence scores)
- **Tumbet Matching**: `create_tumbet_matches_csv.py` ‚Üí creates `tumbet_matches.csv` (Oddswar ‚Üî Tumbet mappings with confidence scores)
- **Stake Matching**: `create_stake_matches_csv.py` ‚Üí creates `stake_matches.csv` (Oddswar ‚Üî Stake mappings with confidence scores) - **TO BE CREATED**

#### API Parser Scripts (Event Creators)
These scripts fetch live and upcoming matches with full details (teams, odds, links):
- `event_create_oddswar.py` ‚Üí `oddswar-formatted.txt` (live + upcoming matches)
- `event_create_stoiximan.py` ‚Üí `stoiximan-formatted.txt` (prematch matches via league-specific endpoint)
  - **API Discovery**: Uses `/api/league/hot/upcoming?leagueId={ID}&req=s,stnf,c,mb` endpoint
  - **League IDs**: Currently hardcoded to Champions League (`182748`)
  - **Coverage**: Returns matches with full 1X2 odds for specified league
  - **Future Work**: Discover and fetch from multiple league IDs to get comprehensive coverage
- `event_create_roobet.py` ‚Üí `roobet-formatted.txt` (live + prematch via Betby API)
- `event_create_tumbet.py` ‚Üí `tumbet-formatted.txt` (live + prematch via SportWide API)
- `event_create_stake.py` ‚Üí `stake-formatted.txt` (TO BE CREATED - will use browser automation like team collector)

These can extract team names from formatted output and add them to `*_names.txt` files to discover new teams.

#### **CRITICAL: Collector Scripts vs Event Creator Scripts**

**Two different purposes that should NOT be confused:**

**1. Collector Scripts (`collect_*_teams.py`):**
- **Purpose**: Build comprehensive team name databases for matching
- **Goal**: Collect as many unique team names as possible (maximum coverage)
- **Output**: `*_names.txt` files containing team names only
- **What they need**: Team names from ALL available matches (including non-featured, lower leagues, etc.)
- **What they DON'T need**: Odds, dates, links, or other match details
- **Strategy**: Use comprehensive API endpoints that return ALL matches, even if they don't have featured odds
- **Example**: For Tumbet, should use `/api/sport/getheader/ot` (1,239 games, 1,700+ teams) instead of `/api/prematch/getprematchtopgames/ot` (69 games, 109 teams)

**2. Event Creator Scripts (`event_create_*.py`):**
- **Purpose**: Fetch actual arbitrage-ready matches with complete details
- **Goal**: Get live + upcoming matches that have active odds for comparison
- **Output**: `*-formatted.txt` files with full match data (teams, odds, dates, links)
- **What they need**: Only matches with featured/active odds that can be used for arbitrage
- **What they DON'T need**: Every possible match in the database
- **Strategy**: Use endpoints that return featured matches with complete odds data
- **Example**: For Tumbet, using `/api/prematch/getprematchtopgames/ot` is fine here (these are the matches with active odds)

**Why This Distinction Matters:**
- Collector scripts maximize team name coverage for Step 1 (team name matching)
- Event creator scripts provide actual arbitrage opportunities
- A site can have 1,700+ teams in the database but only 100 matches with active featured odds
- We want ALL teams for matching, but only featured matches for arbitrage detection

#### Workflow: Proper Team Name Matching Sequence
To perform a complete team name matching run, execute scripts in this order:
1. `collect_oddswar_teams.py` - Collect Oddswar teams (master key)
2. `collect_stoiximan_teams.py` - Collect Stoiximan teams
3. `collect_roobet_teams.py` - Collect Roobet teams
4. `collect_tumbet_teams.py` - Collect Tumbet teams
5. `collect_stake_teams.py` - Collect Stake teams (requires VPN, browser automation)
6. `create_stoiximan_matches_csv.py` - Match Oddswar ‚Üî Stoiximan
7. `create_roobet_matches_csv.py` - Match Oddswar ‚Üî Roobet
8. `create_tumbet_matches_csv.py` - Match Oddswar ‚Üî Tumbet
9. `create_stake_matches_csv.py` - Match Oddswar ‚Üî Stake (TO BE CREATED)

#### Workflow: Cross-Check for Discovering New Team Name Mappings

**Purpose**: The cross-check workflow identifies event matches between Oddswar and traditional sites where team names don't match perfectly but are clearly the same event. This helps discover new team name mappings that should be added to the CSV matching files.

**How It Works:**
1. Uses `temp_compare_events.py` script to compare formatted event files
2. Applies fuzzy matching (currently 65% threshold) to find the same events with name variations
3. Outputs results to `temp.txt` for manual review
4. Results show ONLY events where team names differ (excludes 100% CSV matches)
5. Both team names in each event are checked (not just the first team)

**Usage Examples:**
- **Roobet cross-check**: Compare `oddswar-formatted.txt` with `roobet-formatted.txt`
- **Stoiximan cross-check**: Compare `oddswar-formatted.txt` with `stoiximan-formatted.txt`
- **Tumbet cross-check**: Compare `oddswar-formatted.txt` with `tumbet-formatted.txt`

**Script Execution:**
```bash
# Modify temp_compare_events.py to point to the correct site files
# Then run:
python temp_compare_events.py
```

**Output Format** (`temp.txt`):
- **NO numbering** - just clean event pairs
- Format per match:
  ```
  Oddswar: Team A vs Team B
  Roobet: Team A Name Variant vs Team B Name Variant
  
  Oddswar: Team C vs Team D
  Roobet: Team C vs Team D Different Name
  ```

**Manual Review & Validation Algorithm:**

**Phase 1: Event Match Validation (Review temp.txt)**

**Rule #1: Verify Both Teams in Event Match**
- Must validate BOTH team pairs in each event
- If opponents don't match ‚Üí REJECT entire event (delete both lines)
- Example REJECT:
  ```
  Oddswar: Al-Shabab (KSA) vs Al Najma Club
  Roobet:  Al Shabab      vs Bahla Club  ‚Üê "Al Najma" ‚â† "Bahla"
  ```

**Rule #2: Check for Team Type/Category Mismatches**

Team Type Indicators to Parse:
- **Age groups**: U23, U20, U21, U19, U18
- **Reserve teams**: B, II, " B", "(Res)"
- **Women's teams**: (W), " (W)", "Women"

Matching Requirements:
- If one side has indicator and other doesn't ‚Üí REJECT
- If both have different indicators (e.g., U20 ‚â† U23) ‚Üí REJECT
- Only match if BOTH sides have SAME indicator OR both have NONE

Example REJECT cases:
```
Oddswar: Vietnam U23 vs China U23
Roobet:  Vietnam     vs China        ‚Üê Youth ‚â† Senior

Oddswar: Club Tijuana (W) vs FC Juarez (W)
Roobet:  Club Tijuana de Caliente vs FC Juarez  ‚Üê Women's ‚â† Men's

Oddswar: Hellas Verona U20 vs Cagliari U20
Roobet:  Hellas Verona     vs Cagliari Calcio  ‚Üê Youth ‚â† Senior
```

**Rule #3: Accept Valid Event Matches**
- If BOTH teams validate ‚Üí Keep event in temp.txt (leave untouched)
- If age groups/team types consistent ‚Üí Keep event
- Each valid event yields 2 team name mappings (one for each team)

Example ACCEPT:
```
Oddswar: Novorizontino     vs SE Palmeiras
Roobet:  Gremio Novorizontino SP vs SE Palmeiras SP
‚Üì
Mappings: Novorizontino ‚Üí Gremio Novorizontino SP (100.0)
          SE Palmeiras ‚Üí SE Palmeiras SP (100.0)
```

**Phase 2: CSV Update Process**

For each team pair in validated events:

**Step 1:** Search for Oddswar name in `*_matches.csv`

**Step 2:** Apply update logic:

**Case A: NOT FOUND**
‚Üí Add NEW row:
  - Oddswar: [team name]
  - [Site]: [matching team name]
  - Confidence: 100.0

**Case B: FOUND but [Site] column is EMPTY**
‚Üí Fill in existing row:
  - [Site]: [matching team name]
  - Confidence: 100.0

**Case C: FOUND with DIFFERENT [Site] match**
‚Üí Replace existing match:
  - OLD: Oddswar Team ‚Üí [old match], 100.0
  - NEW: Oddswar Team ‚Üí [new match], 100.0
  - (This corrects previous manual entries that were wrong)

**Confidence Management:**
- All cross-check validated matches get **100.0 confidence**
- After running `create_*_matches_csv.py`, manually review ALL entries < 100.0:
  - Delete if false match
  - Upgrade to 100.0 if valid match
- Result: CSV contains ONLY 100.0 confidence entries (all manually validated)

**Deployment Workflow:**
1. Edit CSV in Apple Numbers (or text editor)
2. Export as CSV to codebase
3. Manually copy file contents to remote server
4. **IMPORTANT**: Collector scripts and `create_*_matches_csv.py` DON'T run on remote
5. Only `event_create_*.py` and `arb_create.py` run on remote
6. Manual CSV edits are SAFE on remote

**Key Principles:**
- **Event-context validation** = High confidence (opponent + timing confirm same event)
- **Always blank `temp.txt` first** before running cross-check
- **Check BOTH team names** in each event match
- Cross-check finds events that fuzzy matching algorithm missed
- Results may include false positives - manual verification required
- Used for improving CSV matching files, not for production matching
- **Context reduces false positives**: Same opponent + same timing = certain match

**Why Event-Context Validation is Superior:**
```
Fuzzy matching alone:
  "Man Utd" vs "Manchester United FC" = 75% similarity ‚Üê Could be coincidence?

Event-context matching:
  Event 1: Man Utd vs Liverpool (2026-01-21 20:00)
  Event 2: Manchester United FC vs Liverpool (2026-01-21 20:00)
  ‚Üê Same opponent + same time = 100% CERTAIN it's the same team!
```

#### **IMPORTANT: Oddswar as Master Key**
- **Oddswar team names are the MASTER KEY** for all comparisons
- All matching is structured as: **Oddswar ‚Üî Traditional Site** (not the reverse)
- **If a team isn't on Oddswar, it won't appear in the software** - Oddswar defines the universe of possible arbitrage opportunities
- This is because:
  - Oddswar is the **exchange** (where you lay/sell odds)
  - Stoiximan/Roobet/Stake/Tumbet are **traditional bookmakers** (where you back/buy odds)
  - Arbitrage identification requires: "Is this Oddswar event also on traditional sites?"
  - Teams/events that only exist on traditional sites (but not Oddswar) are irrelevant for arbitrage
- CSV structure: `Oddswar` column is always first, followed by the traditional site column
- Unmatched traditional site teams (no Oddswar equivalent) are not used

### Step 2: Standardize Event Formats
Events (two teams playing each other) are formatted differently across sites.
- Example formats:
  - "Manchester United vs Liverpool"
  - "Liverpool v Man Utd"
  - "Man United - Liverpool FC"
- **Requirement**: Must identify that these represent the SAME event
- **Dependencies**: Requires Step 1 (team name matching) to be completed first
- **Critical**: Only after BOTH standardizations work can we compare odds

#### Date/Time Matching for Event Validation
**Date/time information is available from all four sites** and will be used as an additional matching criterion:

**Data Availability:**
- **Oddswar**: `openDate` field - ‚úÖ **Verified format**: ISO 8601 string `"2026-01-17T17:45:00.000Z"` (includes milliseconds, UTC timezone with Z suffix)
- **Stoiximan**: `startTime` field (currently extracted, not displayed)
- **Roobet**: `scheduled` field - ‚úÖ **Verified format**: Unix timestamp integer `1768818600` (seconds since epoch, UTC)
- **Tumbet**: `stunix` field - ‚úÖ **Verified format**: Unix timestamp integer `1768938300` (seconds since epoch, UTC)
  - **Bonus**: `st` field also available - ISO 8601 string `"2026-01-20T19:45:00"` (no milliseconds or timezone suffix)

**Event Matching Strategy:**
- Extract and normalize date/time information from all sites to a common format
- Use date/time matching as a **confidence booster** for event identification
- **Matching Rule**: If team name match is ‚â•80% AND date/starttime matches exactly (within reasonable tolerance, e.g., ¬±15 minutes):
  - ‚Üí Mark as **100% event match** (high confidence)
  - This handles cases where team names have slight variations but the match timing confirms it's the same event
- **Example**: 
  - Team match: "Man Utd vs Liverpool" ‚Üî "Manchester United vs Liverpool FC" (85% similarity)
  - Date/time: Both show "2025-12-28 15:00:00"
  - Result: 100% event match (date/time confirms same event despite name variations)

**Implementation Notes:**
- Unix timestamps (Roobet, Tumbet) need conversion to human-readable format for comparison
- Time zone normalization may be required
- Small time differences (¬±15 min) should be tolerated to account for slight API variations
- Date/time matching helps reduce false positives in team name matching

### Why Both Matter
- ‚ùå **Wrong team match** = Comparing different teams = False arbitrage
- ‚ùå **Wrong event format** = Missing valid opportunities or wrong pairings
- ‚úÖ **Both correct** = Valid arbitrage opportunity identification

### Current Status
- ‚úÖ **Step 1 In Progress**: Team name collection and matching
  - **Soccer Coverage:**
    - Oddswar: ~1,874 teams ‚úÖ
    - Stoiximan: ~3,521 teams ‚úÖ (88.8% match rate with Oddswar)
    - Tumbet: ~1,700+ teams ‚úÖ (comprehensive coverage via getheader endpoint)
    - Roobet: ~1,545 teams ‚úÖ (~38% match rate with Oddswar)
    - Stake: ~203 teams ‚úÖ (browser automation, match CSV pending)
  - **Basketball Coverage:**
    - Oddswar: ~128 teams ‚úÖ (collectors complete)
    - Stoiximan: ~36 teams ‚úÖ (live matches only)
    - Tumbet: ~400 teams ‚úÖ (comprehensive coverage via getheader endpoint)
    - Roobet: ~211 teams ‚úÖ (filtered metadata)
- üîú **Step 2 Next**: Event matching across sites (not yet implemented)

### Adding Basketball Support

**Client Requirement**: Expand system to support Basketball in addition to Soccer.

**What's Already Reusable:**
- ‚úÖ Fuzzy matching algorithm (name standardization)
- ‚úÖ Error handling system
- ‚úÖ Telegram notification system
- ‚úÖ Remote daemon infrastructure
- ‚úÖ HTML results generation
- ‚úÖ Git workflow

**What Needs Sport-Specific Changes:**

**1. Odds Structure:**
- **Soccer**: 3-way odds (Team 1 Win / Draw / Team 2 Win) - e.g., 2.05 / 3.40 / 3.80
- **Basketball**: 2-way odds (Team 1 Win / Team 2 Win - overtime decides, no draw) - e.g., 1.95 / 2.05

**2. Implementation Status:**
- **Oddswar**: ‚úÖ Basketball (ID 7522) confirmed working - ~128 teams collected
- **Stoiximan**: ‚úÖ Basketball (ID 'BASK') confirmed working - ~36 teams collected (live only)
- **Roobet**: ‚úÖ Basketball (ID 2) confirmed working - ~211 teams collected
- **Tumbet**: ‚úÖ Basketball (ID 2) confirmed working - ~400 teams collected
- **Stake**: ‚è∏Ô∏è Deferred (Cloudflare issues make it impractical for now)

**3. Collection Scripts (Basketball):**
- ‚úÖ `collect_oddswar_basketball.py` - Created and tested
- ‚úÖ `collect_stoiximan_basketball.py` - Created and tested
- ‚úÖ `collect_roobet_basketball.py` - Created and tested (includes metadata filtering)
- ‚úÖ `collect_tumbet_basketball.py` - Created and tested

**4. Event Creator Scripts (Basketball) - ‚úÖ ALL CREATED:**
- ‚úÖ `event_create_oddswar_basketball.py` - **CREATED & TESTED**
  - Outputs: `oddswar-basketball-formatted.txt`
  - Fetches live + today + upcoming matches via Oddswar API (`/exchange/7522`)
  - Uses MATCH_ODDS market type with LAY odds (pink) for arbitrage
  - 2-way odds: Team 1 Win / Team 2 Win (no draw)
  - Current coverage: ~78 matches from 95 markets (multiple intervals: inplay, today, all)
  - **This is the MASTER KEY** - defines available basketball arbitrage opportunities
- ‚úÖ `event_create_stoiximan_basketball.py` - **CREATED & TESTED**
  - Outputs: `stoiximan-basketball-formatted.txt`
  - Fetches live + featured league matches via Stoiximan API
  - Featured leagues: Euroleague (439g), NBA (441g), Greek Cup (446g), Champions League (456g)
  - Uses Money Line/Match Result market for 2-way odds
  - Current coverage: ~39 matches (10 with odds, 26% success rate)
  - **Limited coverage** as expected (~28 featured games at any time)
  - Includes virtual matches (marked with keywords like ESSENCE, LEGACY)
- ‚úÖ `event_create_roobet_basketball.py` - **CREATED & TESTED**
  - Outputs: `roobet-basketball-formatted.txt`
  - Fetches live + prematch matches via Betby API (all version endpoints)
  - Market ID: '219' (2-way Money Line: selections '5' = Team 1 Win, '4' = Team 2 Win)
  - Current coverage: ~118 matches (96 with odds, 81% success rate)
- ‚úÖ `event_create_tumbet_basketball.py` - **CREATED & TESTED**
  - Outputs: `tumbet-basketball-formatted.txt`
  - Fetches prematch matches via SportWide API (`/sport/getheader` endpoint)
  - Market ID: '103' (Money Line: positions 697 = Team 1 Win, 698 = Team 2 Win)
  - Batched processing (100 games per batch) for comprehensive coverage
  - Current coverage: ~212 matches (204 with odds, 96% success rate) - **BEST COVERAGE**
  - **Note**: Live endpoint broken (404 error) - prematch only for now

**5. Matching CSVs (Basketball) - ‚úÖ ALL CREATED:**
- ‚úÖ `stoiximan_basketball_matches.csv` - Created with preservation logic
- ‚úÖ `roobet_basketball_matches.csv` - Created with preservation logic
- ‚úÖ `tumbet_basketball_matches.csv` - Created with preservation logic

**6. Basketball Event Creators - ‚úÖ ALL CREATED:**
- ‚úÖ `event_create_oddswar_basketball.py` - ~78 matches (MASTER KEY)
- ‚úÖ `event_create_stoiximan_basketball.py` - ~39 matches (10 with odds, 26%)
- ‚úÖ `event_create_roobet_basketball.py` - ~118 matches (96 with odds, 81%)
- ‚úÖ `event_create_tumbet_basketball.py` - ~212 matches (204 with odds, 96%) - **BEST COVERAGE**

**7. Arbitrage Detection - ‚úÖ COMPLETE:**
- ‚úÖ `arb_create.py` - Soccer arbitrage detector (3-way odds)
  - Outputs: `results.html`
  - Sends Telegram notifications for soccer arbitrage opportunities
  - Uses `roobet_matches.csv`, `stoiximan_matches.csv`, `tumbet_matches.csv`
  - Reads from `*-formatted.txt` files (soccer)
- ‚úÖ `arb_basketball_create.py` - **NEW** Basketball arbitrage detector (2-way odds)
  - Outputs: `results_basketball.html`
  - Sends Telegram notifications for basketball arbitrage opportunities (with üèÄ emoji)
  - Uses `roobet_basketball_matches.csv`, `stoiximan_basketball_matches.csv`, `tumbet_basketball_matches.csv`
  - Reads from `*-basketball-formatted.txt` files
  - **COMPLETELY SEPARATE** from soccer system (independent HTML, Telegram, file paths)
  - Tested and working: 27 matched events, 8 arbitrage opportunities detected
  - Telegram notifications sent to all 6 configured users

**Basketball System Status**: ‚úÖ **FULLY COMPLETE** - All components finished!
- ‚úÖ Team collectors (4/4): Oddswar, Roobet, Tumbet, Stoiximan
- ‚úÖ Matching CSVs (3/3): With 100.0 confidence preservation logic
- ‚úÖ Event creators (4/4): Live + prematch data from all sites
- ‚úÖ Arbitrage detector: `arb_basketball_create.py` outputs to `results_basketball.html`
- ‚úÖ Telegram notifications: Sends üèÄ basketball alerts separately from soccer
- **Basketball system is PRODUCTION READY** üöÄ

## Important
This system does NOT place bets automatically. It identifies opportunities for the user to manually execute.

## Development Workflow Rules
- **Remote Server Operations**: DO NOT make ANY changes to the remote production server (89.125.255.32) without the user's express permission
  - DO NOT create, modify, or delete files on the remote server
  - DO NOT generate SSH keys or modify SSH configuration on the remote server
  - DO NOT install packages or change system settings on the remote server
  - DO NOT run any commands via SSH that modify the remote server state
  - ONLY perform read-only operations (checking status, reading files, testing connections) unless explicitly authorized
  - When troubleshooting, propose solutions and ask for permission before implementing them on the production server
  - This is a LIVE PRODUCTION SERVER serving paying clients - treat it with extreme caution
- **Git Operations**: DO NOT perform ANY git operations (add, commit, push, pull, stash, etc.) unless the user explicitly requests it
  - This applies to BOTH local machine AND remote server git commands
  - Do NOT run git commands via SSH on the remote server
  - Only perform git operations when the user gives express permission for that specific operation
  - When user says "commit to git", wait for explicit confirmation before also pushing
- **Flask/Web Development**: When creating Flask applications, ensure maximum cross-platform compatibility between macOS (development) and Linux (production server)
  - Use relative paths, not absolute paths (`./file.txt` not `/Users/giray/...`)
  - Use `os.path.join()` for path construction
  - Use `platform.system()` for any OS-specific logic (like proxy selection)
  - Bind to `0.0.0.0` for remote access, not `127.0.0.1`
  - Test that all file operations work with relative paths
  - Ensure all dependencies are cross-platform (avoid macOS-only or Linux-only packages)
- **Documentation**: DO NOT create large markdown documentation files for small code fixes, bug fixes, or routine changes. Report changes concisely in the chat instead. Reserve documentation files for significant features, architectural decisions, or complex system explanations only.
- **Temporary Files**: When creating temporary scripts (e.g., sanity checks, investigation scripts), use the `temp_` prefix naming convention (e.g., `temp_sanity_check_roobet.py`, `temp_investigate_api.py`). These files are gitignored and should be deleted after use.
- **Bandwidth Optimization**: AVOID browser automation (Selenium, undetected-chromedriver, Playwright, etc.) whenever possible due to excessive bandwidth consumption
  - **Browser automation uses 50-150 MB per scrape** (full page loads, JavaScript, images, CSS, fonts)
  - **API/GraphQL uses 1-3 MB per scrape** (JSON data only)
  - Browser automation creates **50-100x more traffic** than direct API calls
  - On remote server with limited bandwidth quota, browser automation quickly becomes expensive
  - **Always prefer direct API calls** even if they require reverse engineering
  - Only use browser automation as **last resort** when no API alternative exists (e.g., Stake.com)
  - If site has changed APIs and browser automation is being considered, investigate thoroughly first
  - For sites like Stoiximan: if prematch API is unavailable, consider accepting live-only data rather than using browser automation

## Remote Server Information
- **IP Address**: 89.125.255.32
- **Username**: giray
- **Operating System**: Ubuntu (latest release)
- **Python Version**: 3.10.11
- **Location**: Frankfurt, Germany
- **Authentication**: Passwordless SSH with public key (id_rsa)
- **SSH Command**: `ssh giray@89.125.255.32`
- **SCP Command Example**: `scp file.txt giray@89.125.255.32:~/path/to/destination/`
- **Note**: The local machine's private key (id_rsa) has been copied to the remote for GitHub access

## Web Server Setup (Remote Server)

**Purpose**: Serve HTML results files to clients via web browser

**Implementation**: Python's built-in HTTP server (simple, lightweight)

**Configuration:**
- **Port**: 8080
- **Command**: `nohup python3 -m http.server 8080 > http_server.log 2>&1 &`
- **Working Directory**: `/home/giray/harbi/` (serves files from this directory)
- **Log File**: `http_server.log`

**URLs:**
- Soccer results: `http://89.125.255.32:8080/results.html`
- Basketball results: `http://89.125.255.32:8080/results_basketball.html`

**Management:**
```bash
# Check if running
ps aux | grep "http.server 8080"

# Stop server (find PID first)
kill <PID>

# Restart server
cd /home/giray/harbi
nohup python3 -m http.server 8080 > http_server.log 2>&1 &
```

**Additional Services:**
- **Port 5001**: Flask app (`tg_app.py`) - Telegram bot interface at `/tgbot` endpoint

## VPN/Proxy Setup (Gluetun on Remote Server)

**Purpose**: Connect to geoblocked betting sites (Stake.com, Stoiximan) that may require VPN access

**Implementation**: Gluetun Docker containers running on remote server (89.125.255.32)

**Configuration Files:**
- `docker-greece.yaml` - ExpressVPN Greece server (for Stoiximan access)
- `docker-canada.yaml` - ExpressVPN Canada server (for Stake.com access)
- `my_expressvpn_greece_udp.ovpn` - Greece OpenVPN config
- `my_expressvpn_canada_udp.ovpn` - Canada OpenVPN config

**Port Mappings:**
- **Greece Container**: HTTP proxy on 8888, SOCKS5/Shadowsocks on 8390
- **Canada Container**: HTTP proxy on 8889, SOCKS5/Shadowsocks on 8391

**Usage in Python Scripts:**
```python
# For scripts that need VPN access (e.g., collect_stake_teams.py, event_create_stoiximan.py)
proxies = {
    'http': 'http://127.0.0.1:8889',   # Canada VPN for Stake
    'https': 'http://127.0.0.1:8889'
}
response = requests.get(url, proxies=proxies)
```

**Firefox Manual Configuration (for Cloudflare captchas, manual interventions):**

*For Stake.com (Canada VPN):*
- Firefox Settings ‚Üí Network Settings ‚Üí Manual proxy configuration
- HTTP Proxy: `127.0.0.1`, Port: `8889`
- ‚òë Also use this proxy for HTTPS
- Leave SOCKS Host empty
- No proxy for: `localhost, 127.0.0.1`

*For Stoiximan (Greece VPN):*
- Same settings but use Port: `8888`

*Alternative - Command-line launch:*
```bash
# For Stake (Canada)
firefox --proxy-server="http://127.0.0.1:8889" https://stake.com/sports/home

# For Stoiximan (Greece)
firefox --proxy-server="http://127.0.0.1:8888" https://www.stoiximan.gr
```

**FoxyProxy Setup (Recommended - Automatic Proxy Switching):**

*Why use FoxyProxy:*
- Automatically routes Stake.com through Canada proxy (8889)
- Automatically routes Stoiximan through Greece proxy (8888)
- All other sites use direct connection (no proxy)
- No manual proxy switching required

*Installation:*
1. In Firefox, go to: https://addons.mozilla.org/firefox/addon/foxyproxy-standard/
2. Click "Add to Firefox" ‚Üí "Add"

*Configuration:*

**Canada Proxy (for Stake.com):**
1. Click FoxyProxy icon ‚Üí "Options"
2. Click "Add"
3. **Title**: `Canada VPN (Stake)`
4. **Type**: `HTTP`
5. **Hostname**: `127.0.0.1`
6. **Port**: `8889`
7. Go to "Patterns" tab ‚Üí "Add New Pattern"
   - **Pattern Name**: `Stake.com`
   - **Pattern**: `*stake.com*`
   - **Type**: `Wildcard`
8. Click "Save"

**Greece Proxy (for Stoiximan):**
1. Click "Add" again
2. **Title**: `Greece VPN (Stoiximan)`
3. **Type**: `HTTP`
4. **Hostname**: `127.0.0.1`
5. **Port**: `8888`
6. Go to "Patterns" tab ‚Üí "Add New Pattern"
   - **Pattern Name**: `Stoiximan`
   - **Pattern**: `*stoiximan.gr*`
   - **Type**: `Wildcard`
7. Click "Save"

*Usage:*
- Click FoxyProxy icon ‚Üí Select "Proxy by Patterns"
- Stake.com automatically uses Canada VPN
- Stoiximan automatically uses Greece VPN
- All other sites use direct connection
- To disable: Click FoxyProxy icon ‚Üí "Disable FoxyProxy"

**Docker Management Commands:**
```bash
# Start containers
sudo docker-compose -f docker-canada.yaml up -d
sudo docker-compose -f docker-greece.yaml up -d

# Stop containers
sudo docker-compose -f docker-canada.yaml down
sudo docker-compose -f docker-greece.yaml down

# Check status
sudo docker ps

# View logs
sudo docker logs gluetun_canada
sudo docker logs gluetun_greece
```

**Notes:**
- Gluetun provides HTTP proxy (port 8888/8889) and Shadowsocks encrypted proxy (port 8390/8391)
- **HTTP proxy works for HTTPS sites** using HTTP CONNECT tunneling method (confirmed working)
- Shadowsocks is NOT plain SOCKS5 - requires password or SSH tunnel for Firefox testing
- Both containers can run simultaneously (different ports prevent conflicts)
- We may not need these sites in production, but the option is available if required

## Automated Event Fetching System (Remote Server)

**Purpose**: Continuously fetch live odds from all sites with randomized intervals to avoid bot detection

**Implementation Plan**: Python daemon service running on remote server

**Script Location**: `/home/giray/harbi/run_event_loop.py`

**Configuration File (harbi-config.py)**:
```python
# harbi-config.py - Runtime configuration for event fetching daemon

# Sites to fetch (comment out to disable)
ENABLED_SITES = [
    'oddswar',
    'roobet',
    # 'stoiximan',  # Disabled - comment explains why
    'tumbet',
    # 'stake',      # Not ready yet
]

# Run arbitrage detection after each cycle
RUN_ARB_CREATE = True

# Notification settings (for errors/issues)
NOTIFY_ON_ERROR = False  # Future: enable when notification method decided

# Telegram user notifications (comment out to disable)
# Note: arb_create.py will read harbi-config.py to send arbitrage alerts
TELEGRAM_USERS = [
    {'name': 'James', 'id': 1580648939},
    {'name': 'Ismail', 'id': 7530341430},
    # {'name': 'Hidden_Tomi', 'id': 588354800},  # Disabled temporarily
    {'name': 'Totti', 'id': 5387409105},
    {'name': 'AbelardoZ5', 'id': 977623500},
    {'name': 'cassiolincoln10', 'id': 403609484},
]
```

**Script Execution Order:**
- **Oddswar ALWAYS runs first** (it's the master key - defines available arbitrage opportunities)
- After Oddswar, run other enabled sites in config list order
- **All sites run sequentially in the same cycle** (no staggering between sites)
- Randomization applies only to the interval between complete cycles, not between individual sites
- Daemon consults harbi-config.py every cycle (can enable/disable sites without restart)
- If all sites are commented out, daemon does nothing until next trigger

**Config Reloading Implementation:**
```python
# At the start of each cycle, reload config fresh from file
config = {}
with open('harbi-config.py') as f:
    exec(f.read(), config)

# Use: config['ENABLED_SITES'], config['RUN_ARB_CREATE'], config['TELEGRAM_USERS']
```

**Timing Behavior:**
- **Truly random intervals** between cycles (for anti-detection)
- **NOT configurable** - hardcoded randomization logic in daemon itself
- **Vary the randomness pattern to be less predictable**:
  - Don't use same min/max range every time
  - Alternate between different ranges (e.g., 2-4 min, 3-6 min, 4-8 min)
  - Use different probability distributions (not just uniform random)

**Error Handling Strategy:**
1. **Log the error** - write to daemon's log file with timestamp
2. **Continue to next site** - don't let one failure stop the whole cycle
3. **Track failure patterns** - simple counter for consecutive failures
4. **Notification method TBD** - options include Telegram, email, or log file only

**Features:**
- Runtime site enable/disable via harbi-config.py (no restart needed)
- Runs all enabled `event_create_*.py` scripts sequentially
- Runs `arb_create.py` after each cycle (if RUN_ARB_CREATE = True)
- `arb_create.py` reads same harbi-config.py for Telegram user notifications (comment out users to disable)
- Comprehensive logging
- Auto-restart on crash
- systemd service management

**arb_create.py Modifications Required:**
- Must read `harbi-config.py` to get `TELEGRAM_USERS` list
- Send Telegram notifications after generating `results.html`
- Only send notifications if arbitrage opportunities found
- Use HTML formatting template for messages (see Telegram Notification Formatting section)
- Reuse Telegram bot token and sending function from `telegram_notification.py`

**systemd Service File**: `/etc/systemd/system/harbi-events.service`

**Service Commands:**
```bash
sudo systemctl start harbi-events    # Start service
sudo systemctl stop harbi-events     # Stop service
sudo systemctl restart harbi-events  # Restart service
sudo systemctl status harbi-events   # Check status
sudo systemctl enable harbi-events   # Auto-start on boot

# View logs
tail -f /home/giray/harbi/logs/event_loop.log
```

**Why This Approach:**
- ‚úÖ Runtime configuration without restart (comment out sites in harbi-config.py)
- ‚úÖ Unpredictable timing patterns (anti-bot detection)
- ‚úÖ Scripts run sequentially (no overlapping requests to same site)
- ‚úÖ Proper error handling and logging
- ‚úÖ Auto-restart on crash (systemd manages process)
- ‚úÖ Easy monitoring via systemctl
- ‚úÖ Better than cron for continuous services

**Status**: TO BE IMPLEMENTED

---

## Telegram Notification Formatting

**Telegram supports basic HTML/Markdown but NO tables**

**Client Telegram IDs:**
- 1580648939 - James (me - the developer/owner)
- 7530341430 - Ismail
- 588354800 - @Hidden_Tomi
- 5387409105 - @Totti34x (Totti)
- 977623500 - @AbelardoZ5
- 403609484 - @cassiolincoln10

**Supported HTML tags:**
- `<b>bold</b>` - **bold text**
- `<i>italic</i>` - *italic text*
- `<u>underline</u>` - underlined text
- `<code>code</code>` - inline monospace
- `<pre>code block</pre>` - monospace block (good for alignment)
- `<a href="URL">link text</a>` - clickable links
- `<tg-spoiler>hidden</tg-spoiler>` - spoiler text

**Message Structure:**
- Show **ALL arbitrage opportunities** in text message(s)
- Each match gets its own `<pre>` block with links
- If message exceeds 4096 chars, split into multiple messages
- **CRITICAL**: Never split a `<pre>` block in the middle - each match is atomic

**Template for arbitrage notifications:**
```python
# Single message with multiple opportunities:
message = """
üö® *Yeni Harbi Oran Fƒ±rsatlarƒ± Var*

<pre>
Ma√ß: Man United vs Liverpool
Oddswar: <b><u>2.05</u></b> | 3.40 | 3.80
Roobet:  <b><u>2.20</u></b> | <b><u>3.50</u></b> | 3.60
Kar y√ºzdesi: 2.3%
</pre>

<a href="https://oddswar.com/...">Oddswar Linki</a>
<a href="https://roobet.com/...">Roobet Linki</a>

<pre>
Ma√ß: Barcelona vs Real Madrid
Oddswar: 1.95 | <b><u>3.20</u></b> | 4.10
Stoiximan: 1.88 | <b><u>3.45</u></b> | 4.20
Kar y√ºzdesi: 1.8%
</pre>

<a href="https://oddswar.com/...">Oddswar Linki</a>
<a href="https://stoiximan.gr/...">Stoiximan Linki</a>

<pre>
Ma√ß: PSG vs Lyon
Oddswar: <b><u>1.85</u></b> | 3.60 | <b><u>4.50</u></b>
Tumbet:  <b><u>1.92</u></b> | 3.55 | <b><u>4.75</u></b>
Kar y√ºzdesi: 3.1%
</pre>

<a href="https://oddswar.com/...">Oddswar Linki</a>
<a href="https://tumbet.com/...">Tumbet Linki</a>
"""
```

**Smart Message Splitting Algorithm:**
```python
# Pseudocode for implementation:
1. Build each match as atomic block (pre + links)
2. Start with header: "üö® *Yeni Harbi Oran Fƒ±rsatlarƒ± Var*\n\n"
3. For each arbitrage opportunity:
   - If adding block would exceed 4096 chars:
     * Send current message
     * Start new message with same header
   - Add block to current message
4. Send final message
```

**Highlighting Rules:**
- Use `<b><u>bold and underline</u></b>` for **BOTH sides** of arbitrage:
  - **Oddswar odds** where you LAY (sell)
  - **Traditional site odds** where you BACK (buy)
- Only highlight when traditional site odds > Oddswar odds
- Example: If Roobet 2.20 > Oddswar 2.05, highlight BOTH 2.05 and 2.20
- Telegram does NOT support custom text colors, use bold+underline and emojis only

**Profit Calculation:**
- Show "Kar y√ºzdesi" (profit percentage) for each match
- Format: "Kar y√ºzdesi: 2.3%" (one decimal place)
- Calculate based on arbitrage formula

**Implementation Notes:**
- Read `TELEGRAM_USERS` from `harbi-config.py` (not environment variables)
- Only send if arbitrage opportunities found (arb_count > 0)
- Use HTML parse mode (not Markdown)
- Send after generating `results.html`
- Handle Telegram API errors gracefully (log and continue)

**Reuse Existing Logic (Don't Reinvent the Wheel):**

When implementing Telegram notifications in `arb_create.py`, **reuse existing functions and data structures**:

**Already Available in arb_create.py:**
1. **Line 464-481**: `has_arbitrage(event)` function - detects arbitrage opportunities
2. **Line 484**: `matched_events` already sorted (arbitrage opportunities first)
3. **Line 486**: `arb_count` variable - count of arbitrage opportunities  
4. **Lines 302-350**: Odds comparison logic in `generate_html()`:
   ```python
   odds_1_class = ' class="arb-opportunity"' if float(tumbet['odds_1']) > float(oddswar['odds_1']) else ''
   ```
   **This is the SAME logic needed for Telegram highlighting!**
5. **Event structure**: Each event already has:
   - `event['oddswar']` with `odds_1`, `odds_x`, `odds_2`, `link`
   - `event['roobet']` (if matched) with same structure
   - `event['stoiximan']` (if matched) with same structure
   - `event['tumbet']` (if matched) with same structure

**What to Add (Minimal Implementation):**
1. **Config loader** - read `TELEGRAM_USERS` from `harbi-config.py`
2. **Message builder** - convert events to Telegram text format
   - Reuse odds comparison pattern from HTML generation (lines 302-350)
   - Just change output format: HTML class ‚Üí Telegram `<b><u>` tags
3. **Message splitter** - handle 4096 char limit (atomic blocks)
4. **Telegram sender** - API calls to send messages
5. **Integration point** - call after line 500 (after HTML generated), only if `arb_count > 0`

**Smart Approach:**
- Take the **same `matched_events` list** (already filtered and sorted)
- Take the **same `arb_count`** (already calculated)
- Reuse the **same odds comparison pattern** from HTML generation
- Just format differently (HTML ‚Üí Telegram text)

**DO NOT:**
- Duplicate arbitrage detection logic
- Recalculate which events have arbitrage
- Re-sort the events list
- Create new data structures for the same data

---

## Outstanding Tasks / TODO

### High Priority

**1. Find New Tumbet Live Match API Endpoint**
- **Issue**: `/api/live/getlivegames/ot` endpoint returns 404 (broken/moved as of Jan 2026)
- **Current Status**: Only prematch matches available via `getheader` endpoint (1,176+ matches)
- **Impact**: Missing live arbitrage opportunities from Tumbet
- **Investigation Method**: 
  - Open tumbet.com in browser with DevTools Network tab
  - Navigate to live matches section
  - Identify current API endpoint being used
  - Update `event_create_tumbet.py` with new endpoint
- **Alternative**: Accept prematch-only if live data is not critical

### Medium Priority

**2. Modify CSV Matching Scripts to Preserve Manual Entries**
- **Issue**: Running `create_*_matches_csv.py` can delete manually-added mappings if Oddswar team name not in `oddswar_names.txt`
- **Affected Scripts**: `create_roobet_matches_csv.py`, `create_stoiximan_matches_csv.py`, `create_tumbet_matches_csv.py`
- **Solution**: Modify scripts to:
  - Load existing CSV entries (including orphaned ones)
  - Only add/update entries for teams in `oddswar_names.txt`
  - Preserve all existing entries in output
  - Implement deduplication logic (keep 100.0 confidence entries, then any match over no match)
- **Status**: Discussed but not implemented

**3. Create Stake Matching CSV**
- **Script**: `create_stake_matches_csv.py` (TO BE CREATED)
- **Input**: `oddswar_names.txt`, `stake_names.txt`
- **Output**: `stake_matches.csv`
- **Status**: Not started

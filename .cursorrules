# ‚ö†Ô∏è CRITICAL CONTEXT - READ THIS FIRST ‚ö†Ô∏è

**THIS IS COMMISSIONED CLIENT SOFTWARE - NOT A PERSONAL PROJECT**

- **5-6 paying clients** will use this system
- **Clients are Turkish** - all notifications, error messages, and UI text will eventually be in Turkish
- **Clients need web access from anywhere** (no Python knowledge required)
- **Remote production server**: 89.125.255.32 (giray@)
- **Clients CANNOT run scripts manually** - must access via web interface
- **Production deployment is the END GOAL**, not just proof-of-concept
- **Web server required**: Flask application for client access (not simple HTTP server)

**EVERY decision must consider: "Will this work for non-technical clients accessing via web?"**

---

# Harbi - Arbitrage Betting System (Arbing Software)

## Client Requirements

**This is a commissioned software project.** The client requires that all traditional betting sites included in the project operate at **full capacity**, meaning:

- **Maximum team coverage**: Each traditional betting site must have as many team names collected as possible
- **Balanced coverage**: Having 150 teams for one site while another site has 1,000+ teams is **not acceptable**
- **Quality standard**: All included sites must provide comparable and comprehensive team coverage to maximize arbitrage opportunities
- **Implementation priority**: If a site cannot provide adequate team coverage through available API methods, alternative approaches (browser automation, etc.) must be implemented to meet the client's requirements

**Current Coverage Status:**
- Oddswar: ~1,874 teams ‚úÖ (Master key - defines available opportunities)
- Stoiximan: ~3,521 teams ‚úÖ (Excellent coverage - 88.8% match rate)
- Tumbet: ~1,700+ teams ‚úÖ (Excellent coverage - uses comprehensive getheader endpoint)
- Roobet: ~1,545 teams ‚úÖ (Good coverage - ~38% match rate)
- Stake: ~203 teams ‚ö†Ô∏è (Growing - depends on active leagues, browser automation)

## Project Overview

**Project Name**: Harbi

This is **ARBING SOFTWARE**, not betting software. The goal is to identify and exploit odds discrepancies between:
- **Oddswar** (betting exchange - where you can "sell" or lay odds)
- **Stoiximan, Roobet, Stake & Tumbet** (traditional bookmakers - where you "buy" or back odds)

### How Arbitrage Works
1. Find the same event on both exchange and traditional bookmaker
2. Compare odds
3. When there's a profitable spread, "back" on the traditional site and "lay" on Oddswar
4. Profit from the difference with **minimal risk** (not speculative betting)

### Key Distinction
- **Traditional Bookmaker** (Stoiximan/Roobet/Stake/Tumbet): You bet FOR an outcome
- **Betting Exchange** (Oddswar): You can bet AGAINST an outcome (act as the bookmaker)
- **Arbitrage Opportunity**: When backing + laying the same outcome creates guaranteed profit

## Core Challenge: Two-Step Standardization

### Key Definitions
- **Team Name**: A single team (e.g., "Manchester United", "Liverpool FC")
- **Event**: When two teams are playing or have an upcoming match (e.g., "Manchester United vs Liverpool")
- **Goal**: Match team names across sites ‚Üí Match events across sites ‚Üí Compare odds for arbitrage

### Step 1: Standardize Team Names
The same team has different names across bookmakers.
- Example: "Man United" vs "Manchester United FC" vs "Manchester Utd"
- **Current focus**: Building team name mappings (`stoiximan_matches.csv`, `roobet_matches.csv`, `tumbet_matches.csv`)
- **Tools**: Fuzzy matching with special rules (indicators, diacritics)
- **Purpose**: Enable accurate event matching in Step 2

#### Matching Algorithm Details
The matching system uses **indicator-first filtering** to ensure accurate matches:

**Indicators Extracted:**
- **Age groups**: U19, U20, U21, U23 (youth teams)
- **Gender**: (W) (women's teams)
- **Reserve teams**: II or B (treated as equivalent under 'RESERVE' indicator)

**Matching Rules:**
- Teams are filtered by indicators BEFORE fuzzy matching
- Only teams with EXACT matching indicators can be compared
- Examples:
  - ‚úÖ Arsenal U19 ‚Üí can ONLY match teams with U19
  - ‚úÖ Arsenal (W) ‚Üí can ONLY match teams with (W)
  - ‚úÖ Arsenal ‚Üí can ONLY match teams WITHOUT indicators
  - ‚ùå Arsenal U19 ‚Üí CANNOT match Arsenal (no U19)
  - ‚ùå Arsenal (W) ‚Üí CANNOT match Arsenal FC (no W)
  - ‚ùå Juventus U20 ‚Üí CANNOT match Juventus U23 (different ages)

**Normalization Process:**
- **Diacritics removal**: √úmraniyespor ‚Üí Umraniyespor, Be≈üikta≈ü ‚Üí Besiktas
- **Case-insensitive**: NEOM Sports Club ‚Üí neom sports club (for comparison only)
- **Original names preserved**: Output CSVs contain original team names with proper casing

**Fuzzy Matching:**
- Uses `rapidfuzz` library with `fuzz.ratio` scorer
- **Current threshold**: 60% minimum similarity required for a match
- Lower threshold allows catching abbreviations (e.g., "Sports Club" vs "SC" at 60.9%)
- Accepts risk of false positives requiring manual review

#### Team Collection Scripts
- **Oddswar**: `collect_oddswar_teams.py` ‚Üí outputs `oddswar_names.txt`
- **Stoiximan**: `collect_stoiximan_teams.py` ‚Üí outputs `stoiximan_names.txt`
- **Roobet**: `collect_roobet_teams.py` ‚Üí outputs `roobet_names.txt`
  - Uses Betby API (sptpub.com) with two-step version system
  - **Breakthrough discovery**: The `rest_events_versions` array in API manifest unlocks comprehensive coverage
  - **Critical**: Fetches from multiple `rest_events_versions` endpoints (each contains ~160 matches)
  - Changed collection from ~60 teams (main version only) to 700+ teams (all versions)
  - Can collect comprehensive coverage in single run (~10 seconds) vs waiting days/weeks
  - Fetches both LIVE and PREMATCH matches
  - No geographic restrictions
- **Tumbet**: `collect_tumbet_teams.py` ‚Üí outputs `tumbet_names.txt`
  - Uses SportWide API (analytics-sp.googleserv.tech)
  - **Breakthrough discovery**: The `/api/sport/getheader/{LANGUAGE}` endpoint unlocks comprehensive coverage
  - **Critical**: Fetches from hierarchical structure (Sports ‚Üí Regions ‚Üí Championships ‚Üí Games)
  - Changed collection from ~109 teams (top games only) to ~1,700+ teams (all games)
  - Can collect comprehensive coverage in single run (~10-15 seconds with batching)
  - Fetches both LIVE and ALL PREMATCH matches
  - No geographic restrictions on API (website requires Turkish VPN)
- **Stake**: `collect_stake_teams.py` ‚Üí outputs `stake_names.txt`
  - Uses Sportradar (MTS - Managed Trading Services) for odds backend
  - **No public API** - requires browser automation with DOM scraping
  - Uses `undetected-chromedriver` to bypass Cloudflare protection
  - **Geoblocked**: Requires VPN (Canada, Germany, Brazil recommended)
  - **Key selector**: `span.ds-body-md-strong.truncate` (discovered via Browser MCP)
  - Smart `/all` redirect detection: skips empty leagues (off-season)
  - Scrapes 23+ major tournaments across multiple countries
  - Coverage varies by season (leagues redirect to `/all` when no active matches)
  - ~203 teams currently (grows as leagues come in season)
  - **Alternative**: Paid scraping service available at https://scrappey.com/scrapers/finance/stake.com-scraper (may be considered for future use)

#### Team Matching Scripts
- **Stoiximan Matching**: `create_stoiximan_matches_csv.py` ‚Üí creates `stoiximan_matches.csv` (Oddswar ‚Üî Stoiximan mappings with confidence scores)
- **Roobet Matching**: `create_roobet_matches_csv.py` ‚Üí creates `roobet_matches.csv` (Oddswar ‚Üî Roobet mappings with confidence scores)
- **Tumbet Matching**: `create_tumbet_matches_csv.py` ‚Üí creates `tumbet_matches.csv` (Oddswar ‚Üî Tumbet mappings with confidence scores)
- **Stake Matching**: `create_stake_matches_csv.py` ‚Üí creates `stake_matches.csv` (Oddswar ‚Üî Stake mappings with confidence scores) - **TO BE CREATED**

#### API Parser Scripts (Event Creators)
These scripts fetch live and upcoming matches with full details (teams, odds, links):
- `event_create_oddswar.py` ‚Üí `oddswar-formatted.txt` (live + upcoming matches)
- `event_create_stoiximan.py` ‚Üí `stoiximan-formatted.txt` (prematch matches via league-specific endpoint)
  - **API Discovery**: Uses `/api/league/hot/upcoming?leagueId={ID}&req=s,stnf,c,mb` endpoint
  - **League IDs**: Currently hardcoded to Champions League (`182748`)
  - **Coverage**: Returns matches with full 1X2 odds for specified league
  - **Future Work**: Discover and fetch from multiple league IDs to get comprehensive coverage
- `event_create_roobet.py` ‚Üí `roobet-formatted.txt` (live + prematch via Betby API)
- `event_create_tumbet.py` ‚Üí `tumbet-formatted.txt` (live + prematch via SportWide API)
- `event_create_stake.py` ‚Üí `stake-formatted.txt` (TO BE CREATED - will use browser automation like team collector)

These can extract team names from formatted output and add them to `*_names.txt` files to discover new teams.

#### **CRITICAL: Collector Scripts vs Event Creator Scripts**

**Two different purposes that should NOT be confused:**

**1. Collector Scripts (`collect_*_teams.py`):**
- **Purpose**: Build comprehensive team name databases for matching
- **Goal**: Collect as many unique team names as possible (maximum coverage)
- **Output**: `*_names.txt` files containing team names only
- **What they need**: Team names from ALL available matches (including non-featured, lower leagues, etc.)
- **What they DON'T need**: Odds, dates, links, or other match details
- **Strategy**: Use comprehensive API endpoints that return ALL matches, even if they don't have featured odds
- **Example**: For Tumbet, should use `/api/sport/getheader/ot` (1,239 games, 1,700+ teams) instead of `/api/prematch/getprematchtopgames/ot` (69 games, 109 teams)

**2. Event Creator Scripts (`event_create_*.py`):**
- **Purpose**: Fetch actual arbitrage-ready matches with complete details
- **Goal**: Get live + upcoming matches that have active odds for comparison
- **Output**: `*-formatted.txt` files with full match data (teams, odds, dates, links)
- **What they need**: Only matches with featured/active odds that can be used for arbitrage
- **What they DON'T need**: Every possible match in the database
- **Strategy**: Use endpoints that return featured matches with complete odds data
- **Example**: For Tumbet, using `/api/prematch/getprematchtopgames/ot` is fine here (these are the matches with active odds)

**Why This Distinction Matters:**
- Collector scripts maximize team name coverage for Step 1 (team name matching)
- Event creator scripts provide actual arbitrage opportunities
- A site can have 1,700+ teams in the database but only 100 matches with active featured odds
- We want ALL teams for matching, but only featured matches for arbitrage detection

#### Workflow: Proper Team Name Matching Sequence
To perform a complete team name matching run, execute scripts in this order:
1. `collect_oddswar_teams.py` - Collect Oddswar teams (master key)
2. `collect_stoiximan_teams.py` - Collect Stoiximan teams
3. `collect_roobet_teams.py` - Collect Roobet teams
4. `collect_tumbet_teams.py` - Collect Tumbet teams
5. `collect_stake_teams.py` - Collect Stake teams (requires VPN, browser automation)
6. `create_stoiximan_matches_csv.py` - Match Oddswar ‚Üî Stoiximan
7. `create_roobet_matches_csv.py` - Match Oddswar ‚Üî Roobet
8. `create_tumbet_matches_csv.py` - Match Oddswar ‚Üî Tumbet
9. `create_stake_matches_csv.py` - Match Oddswar ‚Üî Stake (TO BE CREATED)

#### **IMPORTANT: Oddswar as Master Key**
- **Oddswar team names are the MASTER KEY** for all comparisons
- All matching is structured as: **Oddswar ‚Üî Traditional Site** (not the reverse)
- **If a team isn't on Oddswar, it won't appear in the software** - Oddswar defines the universe of possible arbitrage opportunities
- This is because:
  - Oddswar is the **exchange** (where you lay/sell odds)
  - Stoiximan/Roobet/Stake/Tumbet are **traditional bookmakers** (where you back/buy odds)
  - Arbitrage identification requires: "Is this Oddswar event also on traditional sites?"
  - Teams/events that only exist on traditional sites (but not Oddswar) are irrelevant for arbitrage
- CSV structure: `Oddswar` column is always first, followed by the traditional site column
- Unmatched traditional site teams (no Oddswar equivalent) are not used

### Step 2: Standardize Event Formats
Events (two teams playing each other) are formatted differently across sites.
- Example formats:
  - "Manchester United vs Liverpool"
  - "Liverpool v Man Utd"
  - "Man United - Liverpool FC"
- **Requirement**: Must identify that these represent the SAME event
- **Dependencies**: Requires Step 1 (team name matching) to be completed first
- **Critical**: Only after BOTH standardizations work can we compare odds

#### Date/Time Matching for Event Validation
**Date/time information is available from all four sites** and will be used as an additional matching criterion:

**Data Availability:**
- **Oddswar**: `openDate` field (currently extracted, not displayed)
- **Stoiximan**: `startTime` field (currently extracted, not displayed)
- **Roobet**: `scheduled` field (Unix timestamp - NOT yet extracted)
- **Tumbet**: `stunix` field (Unix timestamp - currently extracted, not displayed)

**Event Matching Strategy:**
- Extract and normalize date/time information from all sites to a common format
- Use date/time matching as a **confidence booster** for event identification
- **Matching Rule**: If team name match is ‚â•80% AND date/starttime matches exactly (within reasonable tolerance, e.g., ¬±15 minutes):
  - ‚Üí Mark as **100% event match** (high confidence)
  - This handles cases where team names have slight variations but the match timing confirms it's the same event
- **Example**: 
  - Team match: "Man Utd vs Liverpool" ‚Üî "Manchester United vs Liverpool FC" (85% similarity)
  - Date/time: Both show "2025-12-28 15:00:00"
  - Result: 100% event match (date/time confirms same event despite name variations)

**Implementation Notes:**
- Unix timestamps (Roobet, Tumbet) need conversion to human-readable format for comparison
- Time zone normalization may be required
- Small time differences (¬±15 min) should be tolerated to account for slight API variations
- Date/time matching helps reduce false positives in team name matching

### Why Both Matter
- ‚ùå **Wrong team match** = Comparing different teams = False arbitrage
- ‚ùå **Wrong event format** = Missing valid opportunities or wrong pairings
- ‚úÖ **Both correct** = Valid arbitrage opportunity identification

### Current Status
- ‚úÖ **Step 1 In Progress**: Team name collection and matching
  - Oddswar: ~1,874 teams ‚úÖ
  - Stoiximan: ~3,521 teams ‚úÖ (88.8% match rate with Oddswar)
  - Tumbet: ~1,700+ teams ‚úÖ (comprehensive coverage via getheader endpoint)
  - Roobet: ~1,545 teams ‚úÖ (~38% match rate with Oddswar)
  - Stake: ~203 teams ‚úÖ (browser automation, match CSV pending)
- üîú **Step 2 Next**: Event matching across sites (not yet implemented)

## Important
This system does NOT place bets automatically. It identifies opportunities for the user to manually execute.

## Development Workflow Rules
- **Remote Server Operations**: DO NOT make ANY changes to the remote production server (89.125.255.32) without the user's express permission
  - DO NOT create, modify, or delete files on the remote server
  - DO NOT generate SSH keys or modify SSH configuration on the remote server
  - DO NOT install packages or change system settings on the remote server
  - DO NOT run any commands via SSH that modify the remote server state
  - ONLY perform read-only operations (checking status, reading files, testing connections) unless explicitly authorized
  - When troubleshooting, propose solutions and ask for permission before implementing them on the production server
  - This is a LIVE PRODUCTION SERVER serving paying clients - treat it with extreme caution
- **Git Operations**: DO NOT perform ANY git operations (add, commit, push, pull, stash, etc.) unless the user explicitly requests it
  - This applies to BOTH local machine AND remote server git commands
  - Do NOT run git commands via SSH on the remote server
  - Only perform git operations when the user gives express permission for that specific operation
  - When user says "commit to git", wait for explicit confirmation before also pushing
- **Flask/Web Development**: When creating Flask applications, ensure maximum cross-platform compatibility between macOS (development) and Linux (production server)
  - Use relative paths, not absolute paths (`./file.txt` not `/Users/giray/...`)
  - Use `os.path.join()` for path construction
  - Use `platform.system()` for any OS-specific logic (like proxy selection)
  - Bind to `0.0.0.0` for remote access, not `127.0.0.1`
  - Test that all file operations work with relative paths
  - Ensure all dependencies are cross-platform (avoid macOS-only or Linux-only packages)
- **Documentation**: DO NOT create large markdown documentation files for small code fixes, bug fixes, or routine changes. Report changes concisely in the chat instead. Reserve documentation files for significant features, architectural decisions, or complex system explanations only.
- **Temporary Files**: When creating temporary scripts (e.g., sanity checks, investigation scripts), use the `temp_` prefix naming convention (e.g., `temp_sanity_check_roobet.py`, `temp_investigate_api.py`). These files are gitignored and should be deleted after use.

## Remote Server Information
- **IP Address**: 89.125.255.32
- **Username**: giray
- **Operating System**: Ubuntu (latest release)
- **Location**: Frankfurt, Germany
- **Authentication**: Passwordless SSH with public key (id_rsa)
- **SSH Command**: `ssh giray@89.125.255.32`
- **SCP Command Example**: `scp file.txt giray@89.125.255.32:~/path/to/destination/`
- **Note**: The local machine's private key (id_rsa) has been copied to the remote for GitHub access

## VPN/Proxy Setup (Gluetun on Remote Server)

**Purpose**: Connect to geoblocked betting sites (Stake.com, Stoiximan) that may require VPN access

**Implementation**: Gluetun Docker containers running on remote server (89.125.255.32)

**Configuration Files:**
- `docker-greece.yaml` - ExpressVPN Greece server (for Stoiximan access)
- `docker-canada.yaml` - ExpressVPN Canada server (for Stake.com access)
- `my_expressvpn_greece_udp.ovpn` - Greece OpenVPN config
- `my_expressvpn_canada_udp.ovpn` - Canada OpenVPN config

**Port Mappings:**
- **Greece Container**: HTTP proxy on 8888, SOCKS5/Shadowsocks on 8390
- **Canada Container**: HTTP proxy on 8889, SOCKS5/Shadowsocks on 8391

**Usage in Python Scripts:**
```python
# For scripts that need VPN access (e.g., collect_stake_teams.py, event_create_stoiximan.py)
proxies = {
    'http': 'http://127.0.0.1:8889',   # Canada VPN for Stake
    'https': 'http://127.0.0.1:8889'
}
response = requests.get(url, proxies=proxies)
```

**Firefox Manual Configuration (for Cloudflare captchas, manual interventions):**

*For Stake.com (Canada VPN):*
- Firefox Settings ‚Üí Network Settings ‚Üí Manual proxy configuration
- HTTP Proxy: `127.0.0.1`, Port: `8889`
- ‚òë Also use this proxy for HTTPS
- Leave SOCKS Host empty
- No proxy for: `localhost, 127.0.0.1`

*For Stoiximan (Greece VPN):*
- Same settings but use Port: `8888`

*Alternative - Command-line launch:*
```bash
# For Stake (Canada)
firefox --proxy-server="http://127.0.0.1:8889" https://stake.com/sports/home

# For Stoiximan (Greece)
firefox --proxy-server="http://127.0.0.1:8888" https://www.stoiximan.gr
```

**FoxyProxy Setup (Recommended - Automatic Proxy Switching):**

*Why use FoxyProxy:*
- Automatically routes Stake.com through Canada proxy (8889)
- Automatically routes Stoiximan through Greece proxy (8888)
- All other sites use direct connection (no proxy)
- No manual proxy switching required

*Installation:*
1. In Firefox, go to: https://addons.mozilla.org/firefox/addon/foxyproxy-standard/
2. Click "Add to Firefox" ‚Üí "Add"

*Configuration:*

**Canada Proxy (for Stake.com):**
1. Click FoxyProxy icon ‚Üí "Options"
2. Click "Add"
3. **Title**: `Canada VPN (Stake)`
4. **Type**: `HTTP`
5. **Hostname**: `127.0.0.1`
6. **Port**: `8889`
7. Go to "Patterns" tab ‚Üí "Add New Pattern"
   - **Pattern Name**: `Stake.com`
   - **Pattern**: `*stake.com*`
   - **Type**: `Wildcard`
8. Click "Save"

**Greece Proxy (for Stoiximan):**
1. Click "Add" again
2. **Title**: `Greece VPN (Stoiximan)`
3. **Type**: `HTTP`
4. **Hostname**: `127.0.0.1`
5. **Port**: `8888`
6. Go to "Patterns" tab ‚Üí "Add New Pattern"
   - **Pattern Name**: `Stoiximan`
   - **Pattern**: `*stoiximan.gr*`
   - **Type**: `Wildcard`
7. Click "Save"

*Usage:*
- Click FoxyProxy icon ‚Üí Select "Proxy by Patterns"
- Stake.com automatically uses Canada VPN
- Stoiximan automatically uses Greece VPN
- All other sites use direct connection
- To disable: Click FoxyProxy icon ‚Üí "Disable FoxyProxy"

**Docker Management Commands:**
```bash
# Start containers
sudo docker-compose -f docker-canada.yaml up -d
sudo docker-compose -f docker-greece.yaml up -d

# Stop containers
sudo docker-compose -f docker-canada.yaml down
sudo docker-compose -f docker-greece.yaml down

# Check status
sudo docker ps

# View logs
sudo docker logs gluetun_canada
sudo docker logs gluetun_greece
```

**Notes:**
- Gluetun provides HTTP proxy (port 8888/8889) and Shadowsocks encrypted proxy (port 8390/8391)
- **HTTP proxy works for HTTPS sites** using HTTP CONNECT tunneling method (confirmed working)
- Shadowsocks is NOT plain SOCKS5 - requires password or SSH tunnel for Firefox testing
- Both containers can run simultaneously (different ports prevent conflicts)
- We may not need these sites in production, but the option is available if required

## Automated Event Fetching System (Remote Server)

**Purpose**: Continuously fetch live odds from all sites with randomized intervals to avoid bot detection

**Implementation Plan**: Python daemon service running on remote server

**Script Location**: `/home/giray/harbi/run_event_loop.py`

**Configuration File (harbi-config.py)**:
```python
# harbi-config.py - Runtime configuration for event fetching daemon

# Sites to fetch (comment out to disable)
ENABLED_SITES = [
    'oddswar',
    'roobet',
    # 'stoiximan',  # Disabled - comment explains why
    'tumbet',
    # 'stake',      # Not ready yet
]

# Run arbitrage detection after each cycle
RUN_ARB_CREATE = True

# Notification settings (for errors/issues)
NOTIFY_ON_ERROR = False  # Future: enable when notification method decided

# Telegram user notifications (comment out to disable)
# Note: arb_create.py will read harbi-config.py to send arbitrage alerts
TELEGRAM_USERS = [
    {'name': 'James', 'id': 1580648939},
    {'name': 'Ismail', 'id': 7530341430},
    # {'name': 'Hidden_Tomi', 'id': 588354800},  # Disabled temporarily
    {'name': 'Totti', 'id': 5387409105},
    {'name': 'AbelardoZ5', 'id': 977623500},
    {'name': 'cassiolincoln10', 'id': 403609484},
]
```

**Script Execution Order:**
- **Oddswar ALWAYS runs first** (it's the master key - defines available arbitrage opportunities)
- After Oddswar, run other enabled sites in config list order
- **All sites run sequentially in the same cycle** (no staggering between sites)
- Randomization applies only to the interval between complete cycles, not between individual sites
- Daemon consults harbi-config.py every cycle (can enable/disable sites without restart)
- If all sites are commented out, daemon does nothing until next trigger

**Timing Behavior:**
- **Truly random intervals** between cycles (for anti-detection)
- **NOT configurable** - hardcoded randomization logic in daemon itself
- **Vary the randomness pattern to be less predictable**:
  - Don't use same min/max range every time
  - Alternate between different ranges (e.g., 2-4 min, 3-6 min, 4-8 min)
  - Use different probability distributions (not just uniform random)

**Error Handling Strategy:**
1. **Log the error** - write to daemon's log file with timestamp
2. **Continue to next site** - don't let one failure stop the whole cycle
3. **Track failure patterns** - simple counter for consecutive failures
4. **Notification method TBD** - options include Telegram, email, or log file only

**Features:**
- Runtime site enable/disable via harbi-config.py (no restart needed)
- Runs all enabled `event_create_*.py` scripts sequentially
- Runs `arb_create.py` after each cycle (if RUN_ARB_CREATE = True)
- `arb_create.py` reads same harbi-config.py for Telegram user notifications (comment out users to disable)
- Comprehensive logging
- Auto-restart on crash
- systemd service management

**systemd Service File**: `/etc/systemd/system/harbi-events.service`

**Service Commands:**
```bash
sudo systemctl start harbi-events    # Start service
sudo systemctl stop harbi-events     # Stop service
sudo systemctl restart harbi-events  # Restart service
sudo systemctl status harbi-events   # Check status
sudo systemctl enable harbi-events   # Auto-start on boot

# View logs
tail -f /home/giray/harbi/logs/event_loop.log
```

**Why This Approach:**
- ‚úÖ Runtime configuration without restart (comment out sites in harbi-config.py)
- ‚úÖ Unpredictable timing patterns (anti-bot detection)
- ‚úÖ Scripts run sequentially (no overlapping requests to same site)
- ‚úÖ Proper error handling and logging
- ‚úÖ Auto-restart on crash (systemd manages process)
- ‚úÖ Easy monitoring via systemctl
- ‚úÖ Better than cron for continuous services

**Status**: TO BE IMPLEMENTED

---

## Telegram Notification Formatting

**Telegram supports basic HTML/Markdown but NO tables**

**Client Telegram IDs:**
- 1580648939 - James (me - the developer/owner)
- 7530341430 - Ismail
- 588354800 - @Hidden_Tomi
- 5387409105 - @Totti34x (Totti)
- 977623500 - @AbelardoZ5
- 403609484 - @cassiolincoln10

**Supported HTML tags:**
- `<b>bold</b>` - **bold text**
- `<i>italic</i>` - *italic text*
- `<u>underline</u>` - underlined text
- `<code>code</code>` - inline monospace
- `<pre>code block</pre>` - monospace block (good for alignment)
- `<a href="URL">link text</a>` - clickable links
- `<tg-spoiler>hidden</tg-spoiler>` - spoiler text

**Template for arbitrage notifications:**
```python
message = """
üö® *Arbitrage Alert - 3 Opportunities*

<pre>
Ma√ß: Man United vs Liverpool
Oddswar: 2.05 | 3.40 | 3.80
Roobet:  <b><u>2.20</u></b> | <b><u>3.50</u></b> | 3.60
Kar y√ºzdesi: 2.3% (odds 1 & X)
</pre>

<a href="https://oddswar.com/...">Oddswar Linki</a>
<a href="https://roobet.com/...">Roobet Linki</a>
"""
```

**Notes:**
- Use `<pre>` tags with careful spacing for aligned columns (tables are not supported)
- Use `<b><u>bold and underline</u></b>` tags to highlight odds that are higher than corresponding Oddswar odds (arbitrage opportunities)
- Telegram does NOT support custom text colors, use bold and emojis for emphasis
